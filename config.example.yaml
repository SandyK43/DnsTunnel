# DNS Tunnel Detection Service - Example Configuration
# Copy this to config.yaml and customize for your environment

# Detection Settings
detection:
  # Anomaly score thresholds (0.0 - 1.0)
  # NOTE: If adaptive_thresholds is enabled, these are INITIAL values only
  threshold_suspicious: 0.70  # Warning level
  threshold_high: 0.85        # Critical level

  # Analysis window in seconds
  window_size: 60

  # Path to trained ML model
  model_path: models/isolation_forest.pkl

# Adaptive Thresholds (Machine Learning-Based Auto-Adjustment)
adaptive_thresholds:
  # Enable adaptive threshold adjustment
  # When enabled, thresholds adjust automatically based on false positive rate and analyst feedback
  enabled: true

  # Target false positive rate (3% recommended)
  target_fp_rate: 0.03

  # Maximum tolerable false positive rate before increasing thresholds
  max_fp_rate: 0.10

  # Minimum false positive rate (too low may mean missing threats)
  min_fp_rate: 0.01

  # How much to adjust thresholds each time
  adjustment_increment: 0.02

  # Minimum samples required before adjusting (number of analyst feedback entries)
  min_samples_for_adjustment: 100

  # How often to check for threshold adjustments (minutes)
  check_interval_minutes: 60

  # Minimum time between adjustments (hours)
  max_adjustment_frequency_hours: 6

  # Time window for performance evaluation (hours)
  evaluation_window_hours: 24

  # Safety limits
  min_threshold: 0.50  # Never go below this
  max_threshold: 0.95  # Never go above this

# Database Configuration
database:
  # Option 1: SQLite (embedded, no setup required)
  type: sqlite
  path: data/dns_tunnel.db

  # Option 2: PostgreSQL (uncomment to use)
  # type: postgresql
  # host: localhost
  # port: 5432
  # database: dns_tunnel_db
  # username: dnsadmin
  # password: changeme123

# Alerting Configuration
alerting:
  # Throttle alerts (seconds between duplicate alerts)
  throttle_seconds: 300

  # Slack Integration
  slack:
    enabled: false
    webhook_url: https://hooks.slack.com/services/YOUR/WEBHOOK/URL

  # Email Integration
  email:
    enabled: true
    smtp_host: smtp.gmail.com
    smtp_port: 587
    from_address: alerts@company.com
    to_addresses: security@company.com,soc@company.com
    username: your-email@gmail.com
    password: your-app-password

  # JIRA Integration
  jira:
    enabled: false
    url: https://your-company.atlassian.net
    username: your-email@company.com
    api_token: your-api-token
    project_key: SEC

  # Microsoft Teams Integration
  teams:
    enabled: false
    webhook_url: https://outlook.office.com/webhook/YOUR/WEBHOOK/URL

  # Syslog Integration (for SIEM)
  syslog:
    enabled: false
    host: syslog.company.com
    port: 514
    protocol: udp

# Automated Response Configuration
response:
  # Enable automated blocking (use with caution!)
  auto_block: false

  # Require manual approval before blocking
  require_manual_approval: true

  # Default block duration (minutes)
  default_duration: 60

  # Firewall integration
  firewall:
    enabled: false
    type: iptables  # Options: iptables, pf, windows_firewall

# Log Collection Configuration
collector:
  # Enable automatic log collection
  enabled: true

  # Log sources
  sources:
    # File-based collection (Zeek, Bind9, etc.)
    - type: file
      path: /var/log/zeek/dns.log
      format: zeek  # Options: zeek, bind, json

    # Network capture (requires root/admin)
    # - type: pcap
    #   interface: eth0
    #   filter: "port 53"

    # API-only mode (no automatic collection)
    # sources: []

# API Configuration
api:
  # Bind address (0.0.0.0 = all interfaces, 127.0.0.1 = localhost only)
  host: 0.0.0.0

  # Port number
  port: 8000

  # Enable API authentication (recommended for production)
  auth_enabled: false
  api_key: change-this-to-random-string

  # CORS settings
  cors_origins:
    - "*"  # Change to specific domains in production

  # SSL/TLS Configuration (recommended for production)
  ssl_enabled: false
  ssl_cert: /path/to/cert.pem
  ssl_key: /path/to/key.pem

# Logging Configuration
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: INFO

  # Log file rotation
  rotation: "10 MB"

  # Log retention
  retention: "30 days"

  # Log directory
  directory: logs

# Performance Tuning
performance:
  # Maximum queries per second to process
  max_queries_per_second: 1000

  # Worker threads for parallel processing
  workers: 4

  # Cache settings
  cache:
    enabled: true
    ttl: 300  # seconds
    max_size: 10000  # entries

# Model Retraining
retraining:
  # Enable automated weekly retraining
  enabled: true

  # Schedule (cron format: minute hour day month weekday)
  schedule: "0 2 * * 0"  # Sunday at 2:00 AM

  # Minimum samples required for retraining
  min_samples: 5000

  # Validation threshold (model must meet this accuracy)
  min_accuracy: 0.95

# Monitoring
monitoring:
  # Prometheus metrics endpoint
  prometheus_enabled: true
  prometheus_port: 9090

  # Health check endpoint
  health_check_enabled: true

  # Performance metrics
  metrics:
    - query_processing_time
    - detection_accuracy
    - alert_frequency
    - false_positive_rate

# Data Retention
retention:
  # Keep DNS query logs (days)
  dns_queries: 90

  # Keep alerts (days)
  alerts: 365

  # Keep response actions (days)
  actions: 365

  # Automatic cleanup
  auto_cleanup: true
  cleanup_schedule: "0 3 * * *"  # Daily at 3:00 AM

# Security Settings
security:
  # Rate limiting (requests per minute per IP)
  rate_limit: 60

  # IP whitelist (bypass detection for trusted IPs)
  whitelist:
    - 10.0.0.0/8
    - 192.168.0.0/16

  # Domain whitelist (bypass detection for trusted domains)
  domain_whitelist:
    - example.com
    - company.local

  # Maximum query length to analyze
  max_query_length: 255

# Notifications
notifications:
  # Daily summary report
  daily_summary:
    enabled: true
    time: "09:00"
    recipients:
      - security-team@company.com

  # Weekly statistics report
  weekly_report:
    enabled: true
    day: monday
    time: "09:00"
    recipients:
      - management@company.com

# Experimental Features
experimental:
  # Use advanced ML models (requires more resources)
  advanced_models: false

  # Enable behavioral analysis
  behavioral_analysis: false

  # Deep packet inspection
  deep_inspection: false
